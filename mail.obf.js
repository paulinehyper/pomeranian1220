const a0_0x38088e=a0_0xec7d;function a0_0x4a3b(){const _0x11f92d=['mailId','syncMail','1776819nEqjew','mailparser','startsWith','INBOX','SELECT\x20COUNT(*)\x20as\x20cnt\x20FROM\x20emails\x20WHERE\x20unique_hash\x20=\x20?','retr','prepare','mail_pw','crypto','6piMTmO','4WLYopP','stat','mail_server','update','substring','isArray','received_at','mailServer','utf-8','find','[mail.js]\x20mailConnect\x20info.mailSince:','login','cnt','syncMail(IMAP)\x20에러:','...\x22\x20->\x20','mail-connect','handle','getFullYear','sort','imap-simple','imap','[syncMail]\x20검색\x20조건:','connect','hex','getDate','decode','message','poplib','which','from','pop3-secure','getMonth','log','get','12903272DrNkTW','toString','458242aSGtHZ','createHash','content-type','mail_since','exports','error','mailSince','pop3','4449571DdCuEG','string','length','date','[날짜\x20추출\x20성공]\x20\x22','subject','sha256','openBox','search','max','SINCE','[syncMail]\x20최신\x2010개\x20메일만\x20처리:\x20','SELECT\x20received_at\x20FROM\x20emails\x20ORDER\x20BY\x20received_at\x20DESC\x20LIMIT\x201','digest','toISOString','html','지원하지\x20않는\x20프로토콜입니다.','691675aFmgkN','imap-secure','imap-ssl','padStart','quit','protocol','stringify','mail_id','binary','_sortDate','trim','TEXT','quoted-printable','메일\x20서버\x20주소(host)를\x20입력해야\x20합니다.','getTime','text','parts','1933340cuSQDp','iconv-lite','./main','slice','match','html-to-text','17461458mKAtqk','end','host','body','run','HEADER'];a0_0x4a3b=function(){return _0x11f92d;};return a0_0x4a3b();}(function(_0x5cd3ff,_0x2c78ad){const _0x252980=a0_0xec7d,_0x4633fc=_0x5cd3ff();while(!![]){try{const _0x3ee696=-parseInt(_0x252980(0x12c))/0x1+parseInt(_0x252980(0x113))/0x2+-parseInt(_0x252980(0x14b))/0x3*(-parseInt(_0x252980(0x155))/0x4)+parseInt(_0x252980(0x13d))/0x5+parseInt(_0x252980(0x154))/0x6*(parseInt(_0x252980(0x11b))/0x7)+parseInt(_0x252980(0x111))/0x8+-parseInt(_0x252980(0x143))/0x9;if(_0x3ee696===_0x2c78ad)break;else _0x4633fc['push'](_0x4633fc['shift']());}catch(_0x3633c5){_0x4633fc['push'](_0x4633fc['shift']());}}}(a0_0x4a3b,0xc95d3));function a0_0xec7d(_0x33a594,_0x869bad){_0x33a594=_0x33a594-0x10f;const _0x4a3bdb=a0_0x4a3b();let _0xec7d97=_0x4a3bdb[_0x33a594];return _0xec7d97;}const {ipcMain}=require('electron'),Imap=require(a0_0x38088e(0x168)),Poplib=require(a0_0x38088e(0x170)),db=require('./db');function getMailConfig(_0x450081){const _0x4f10a3=a0_0x38088e;console[_0x4f10a3(0x10f)](_0x4f10a3(0x15f),_0x450081[_0x4f10a3(0x119)]);let _0x47a2da='',_0x4bde72,_0x186bb6;if(_0x450081[_0x4f10a3(0x145)]&&_0x450081[_0x4f10a3(0x145)][_0x4f10a3(0x136)]())_0x47a2da=_0x450081['host'][_0x4f10a3(0x136)]();else{if(_0x450081['mail_server']&&_0x450081['mail_server'][_0x4f10a3(0x136)]())_0x47a2da=_0x450081[_0x4f10a3(0x157)][_0x4f10a3(0x136)]();else _0x450081[_0x4f10a3(0x15c)]&&_0x450081[_0x4f10a3(0x15c)][_0x4f10a3(0x136)]()?_0x47a2da=_0x450081[_0x4f10a3(0x15c)]['trim']():_0x47a2da='';}if(!_0x47a2da)throw new Error(_0x4f10a3(0x139));if(_0x450081[_0x4f10a3(0x131)]===_0x4f10a3(0x12e)||_0x450081[_0x4f10a3(0x131)]===_0x4f10a3(0x12d))_0x4bde72=0x3e1,_0x186bb6=!![];else{if(_0x450081['protocol']===_0x4f10a3(0x169))_0x4bde72=0x8f,_0x186bb6=![];else{if(_0x450081[_0x4f10a3(0x131)]==='pop3-ssl'||_0x450081[_0x4f10a3(0x131)]===_0x4f10a3(0x173))_0x4bde72=0x3e3,_0x186bb6=!![];else _0x450081[_0x4f10a3(0x131)]===_0x4f10a3(0x11a)&&(_0x4bde72=0x6e,_0x186bb6=![]);}}return{'user':_0x450081[_0x4f10a3(0x149)]||_0x450081[_0x4f10a3(0x133)],'password':_0x450081['mailPw']||_0x450081[_0x4f10a3(0x152)],'host':_0x47a2da,'port':_0x4bde72,'tls':_0x186bb6,'authTimeout':0x1388,'tlsOptions':{'rejectUnauthorized':![]}};}function setupMailIpc(_0x276ba5){const _0x14e30d=a0_0x38088e;function _0x67f0fb(_0x4475b1){const _0x2e25d4=a0_0xec7d;let _0x29c018=['ALL'];const _0x4b079d=_0x4475b1[_0x2e25d4(0x119)]||_0x4475b1[_0x2e25d4(0x116)];if(_0x4b079d){const _0x4e3e34=new Date(_0x4b079d);!isNaN(_0x4e3e34[_0x2e25d4(0x13a)]())&&(_0x29c018=[['SINCE',_0x4e3e34]]);}const _0x36da14=db[_0x2e25d4(0x151)](_0x2e25d4(0x127))['get']();if(_0x36da14&&_0x36da14[_0x2e25d4(0x15b)]){const _0x3e3e00=new Date(_0x36da14[_0x2e25d4(0x15b)]);!isNaN(_0x3e3e00[_0x2e25d4(0x13a)]())&&(_0x29c018=[[_0x2e25d4(0x125),_0x3e3e00]]);}return _0x29c018;}async function _0x22ae0b(_0x119896){const _0x3ad572=a0_0xec7d,_0x7319c7=getMailConfig(_0x119896);if(_0x119896[_0x3ad572(0x131)][_0x3ad572(0x14d)](_0x3ad572(0x169)))try{const _0x3fbb4c=await Imap[_0x3ad572(0x16b)]({'imap':_0x7319c7});await _0x3fbb4c[_0x3ad572(0x122)](_0x3ad572(0x14e));const _0x281ef8=_0x67f0fb(_0x119896);console[_0x3ad572(0x10f)](_0x3ad572(0x16a),JSON[_0x3ad572(0x132)](_0x281ef8));const _0xd3970c={'bodies':[_0x3ad572(0x148),_0x3ad572(0x137)],'struct':!![]};let _0x54010f=await _0x3fbb4c[_0x3ad572(0x123)](_0x281ef8,_0xd3970c);_0x54010f=_0x54010f['map'](_0x253f89=>{const _0x5f1eb2=_0x3ad572,_0x121eae=_0x253f89['parts'][_0x5f1eb2(0x15e)](_0x461be7=>_0x461be7['which']==='HEADER');let _0x305f83='';return _0x121eae&&_0x121eae[_0x5f1eb2(0x146)]&&(_0x305f83=Array[_0x5f1eb2(0x15a)](_0x121eae[_0x5f1eb2(0x146)][_0x5f1eb2(0x11e)])?_0x121eae[_0x5f1eb2(0x146)]['date'][0x0]:_0x121eae[_0x5f1eb2(0x146)][_0x5f1eb2(0x11e)]||''),{..._0x253f89,'_sortDate':new Date(_0x305f83)['getTime']()||0x0};})[_0x3ad572(0x167)]((_0x5e5bb8,_0x26654c)=>_0x26654c[_0x3ad572(0x135)]-_0x5e5bb8[_0x3ad572(0x135)])[_0x3ad572(0x140)](0x0,0xa),console[_0x3ad572(0x10f)](_0x3ad572(0x126)+_0x54010f[_0x3ad572(0x11d)]+'건');const {simpleParser:_0x37eb4c}=require(_0x3ad572(0x14c)),_0x453ef0=require('crypto'),_0x1c1234=db['prepare'](_0x3ad572(0x14f));for(const _0x45986d of _0x54010f){try{const _0xdb8762=_0x45986d[_0x3ad572(0x13c)][_0x3ad572(0x15e)](_0x266fff=>_0x266fff[_0x3ad572(0x171)]===_0x3ad572(0x148)),_0x16da4f=_0x45986d[_0x3ad572(0x13c)][_0x3ad572(0x15e)](_0xd0e797=>_0xd0e797[_0x3ad572(0x171)]===_0x3ad572(0x137));let _0x4a1f7a='',_0x343990='',_0x3e4e32='';_0xdb8762&&_0xdb8762[_0x3ad572(0x146)]&&(_0x4a1f7a=Array[_0x3ad572(0x15a)](_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x120)])?_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x120)][0x0]:_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x120)]||'',_0x343990=Array[_0x3ad572(0x15a)](_0xdb8762[_0x3ad572(0x146)]['from'])?_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x172)][0x0]:_0xdb8762['body'][_0x3ad572(0x172)]||'',_0x3e4e32=Array[_0x3ad572(0x15a)](_0xdb8762[_0x3ad572(0x146)]['date'])?_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x11e)][0x0]:_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x11e)]||'');let _0x1a0c7b='';if(_0x16da4f&&_0x16da4f[_0x3ad572(0x146)]){const {simpleParser:_0x5d37a6}=require(_0x3ad572(0x14c)),{htmlToText:_0x31f980}=require(_0x3ad572(0x142)),_0x355273=require(_0x3ad572(0x138)),_0x37e0a8=require(_0x3ad572(0x13e));let _0x1cef39=_0x16da4f[_0x3ad572(0x146)];if(typeof _0x1cef39===_0x3ad572(0x11c)&&/=\d{2}/i['test'](_0x1cef39))try{_0x1cef39=_0x355273[_0x3ad572(0x16e)](_0x1cef39);let _0x1141a0=_0x3ad572(0x15d);if(_0xdb8762&&_0xdb8762[_0x3ad572(0x146)]&&_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x115)]){const _0x23ad86=Array[_0x3ad572(0x15a)](_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x115)])?_0xdb8762[_0x3ad572(0x146)][_0x3ad572(0x115)][0x0]:_0xdb8762[_0x3ad572(0x146)]['content-type'],_0x345d38=_0x23ad86[_0x3ad572(0x141)](/charset\s*=\s*"?([a-zA-Z0-9\-]+)"?/i);if(_0x345d38&&_0x345d38[0x1])_0x1141a0=_0x345d38[0x1]['toLowerCase']();}_0x1cef39=_0x37e0a8['decode'](Buffer[_0x3ad572(0x172)](_0x1cef39,_0x3ad572(0x134)),_0x1141a0);}catch(_0x1fb85d){}try{const _0x4af993=await _0x5d37a6(_0x1cef39);if(_0x4af993[_0x3ad572(0x12a)])_0x1a0c7b=_0x31f980(_0x4af993['html'],{'wordwrap':![]});else _0x4af993[_0x3ad572(0x13b)]?_0x1a0c7b=_0x4af993[_0x3ad572(0x13b)]:_0x1a0c7b=_0x1cef39['toString']();}catch(_0x36776c){_0x1a0c7b=_0x1cef39[_0x3ad572(0x112)]();}}const _0x5766c8=_0x453ef0[_0x3ad572(0x114)]('sha256')[_0x3ad572(0x158)]((_0x4a1f7a||'')+(_0x1a0c7b||'')+(_0x343990||'')+(_0x3e4e32||''))[_0x3ad572(0x128)](_0x3ad572(0x16c)),{autoClassifyEmailTodo:_0x39f1e6}=require(_0x3ad572(0x13f));let _0x131c41=_0x39f1e6(_0x4a1f7a,_0x1a0c7b);const _0x143421=extractDeadline(_0x4a1f7a)||extractDeadline(_0x1a0c7b);if(!_0x1c1234[_0x3ad572(0x110)](_0x5766c8)[_0x3ad572(0x161)]){const _0x41d6d0=_0x119896[_0x3ad572(0x119)]||new Date()[_0x3ad572(0x129)](),_0xb93a9a=require(_0x3ad572(0x153))[_0x3ad572(0x114)](_0x3ad572(0x121))[_0x3ad572(0x158)]((_0x3e4e32||'')+(_0x4a1f7a||''))[_0x3ad572(0x128)](_0x3ad572(0x16c));db[_0x3ad572(0x151)]('INSERT\x20INTO\x20emails\x20(received_at,\x20subject,\x20body,\x20from_addr,\x20todo_flag,\x20unique_hash,\x20deadline,\x20created_at,\x20email_hash)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)')[_0x3ad572(0x147)](_0x3e4e32,_0x4a1f7a,_0x1a0c7b,_0x343990,_0x131c41,_0x5766c8,_0x143421,_0x41d6d0,_0xb93a9a);}}catch(_0x2b006b){}}return await _0x3fbb4c[_0x3ad572(0x144)](),{'success':!![],'count':_0x54010f[_0x3ad572(0x11d)]};}catch(_0x4615f9){return console['error'](_0x3ad572(0x162),_0x4615f9),{'success':![],'message':_0x4615f9['message']};}else return _0x119896['protocol'][_0x3ad572(0x14d)](_0x3ad572(0x11a))?new Promise(_0x43778c=>{const _0x33def5=_0x3ad572,_0x2ef284=Poplib,{host:_0x20e556,port:_0x36ac44,tls:_0x211772,user:_0x5dc731,password:_0xb9850}=_0x7319c7,_0x1f68d6=new _0x2ef284(_0x36ac44,_0x20e556,{'tlserrs':![],'enabletls':_0x211772,'debug':![]});let _0x13204a=0x0,_0x173158=0x1,_0x4f12c9=0x1,_0x5556c1=0x1,_0x16f713=null;_0x1f68d6['on'](_0x33def5(0x118),function(_0x5b75ff){const _0x2dd0aa=_0x33def5;_0x16f713=_0x5b75ff[_0x2dd0aa(0x16f)],_0x1f68d6['quit']();}),_0x1f68d6['on'](_0x33def5(0x16b),function(){const _0x505615=_0x33def5;_0x1f68d6[_0x505615(0x160)](_0x5dc731,_0xb9850);}),_0x1f68d6['on'](_0x33def5(0x160),function(_0x3e609e,_0x5b0cfa){const _0x9d0bfb=_0x33def5;_0x3e609e?_0x1f68d6[_0x9d0bfb(0x156)]():(_0x16f713='POP3\x20로그인\x20실패',_0x1f68d6[_0x9d0bfb(0x130)]());}),_0x1f68d6['on'](_0x33def5(0x156),function(_0x5d601c,_0x596f4f){const _0x276570=_0x33def5;_0x5d601c&&_0x596f4f[0x0]>0x0?(_0x13204a=_0x596f4f[0x0],_0x4f12c9=Math[_0x276570(0x124)](0x1,_0x13204a-0x9),_0x5556c1=_0x13204a,_0x173158=_0x4f12c9,_0xd41804()):_0x1f68d6[_0x276570(0x130)]();});function _0xd41804(){const _0x14d9f7=_0x33def5;if(_0x173158>_0x5556c1){_0x1f68d6['quit']();return;}_0x1f68d6[_0x14d9f7(0x150)](_0x173158);}_0x1f68d6['on'](_0x33def5(0x150),async function(_0x3f7d7a,_0x31060c,_0x1d776e,_0x4d829a){const _0x360a95=_0x33def5;if(_0x3f7d7a)try{const {simpleParser:_0x427343}=require(_0x360a95(0x14c)),_0x16da26=await _0x427343(_0x1d776e),_0x2938c8=_0x16da26[_0x360a95(0x120)]||'',_0x27ac31=_0x16da26[_0x360a95(0x172)]&&_0x16da26['from']['text']?_0x16da26[_0x360a95(0x172)][_0x360a95(0x13b)]:'',_0x1c84dc=_0x16da26['date']?new Date(_0x16da26[_0x360a95(0x11e)])[_0x360a95(0x129)]():'',_0xd55734=_0x16da26[_0x360a95(0x13b)]||'',_0xcdda23=require('crypto'),_0x13690c=_0xcdda23['createHash']('sha256')[_0x360a95(0x158)]((_0x2938c8||'')+(_0xd55734||'')+(_0x27ac31||'')+(_0x1c84dc||''))[_0x360a95(0x128)](_0x360a95(0x16c)),_0x286f59=db[_0x360a95(0x151)](_0x360a95(0x14f)),{autoClassifyEmailTodo:_0x4c3138}=require(_0x360a95(0x13f));let _0x1f1007=_0x4c3138(_0x2938c8,_0xd55734);const _0x314451=extractDeadline(_0x2938c8)||extractDeadline(_0xd55734);if(!_0x286f59[_0x360a95(0x110)](_0x13690c)[_0x360a95(0x161)]){const _0x4d30aa=_0x119896['mailSince']||new Date()[_0x360a95(0x129)](),_0x4438fb=require(_0x360a95(0x153))['createHash'](_0x360a95(0x121))[_0x360a95(0x158)]((_0x1c84dc||'')+(_0x2938c8||''))[_0x360a95(0x128)](_0x360a95(0x16c));db['prepare']('INSERT\x20INTO\x20emails\x20(received_at,\x20subject,\x20body,\x20from_addr,\x20todo_flag,\x20unique_hash,\x20deadline,\x20created_at,\x20email_hash)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)')[_0x360a95(0x147)](_0x1c84dc,_0x2938c8,_0xd55734,_0x27ac31,_0x1f1007,_0x13690c,_0x314451,_0x4d30aa,_0x4438fb);}}catch(_0x3bf6b2){}_0x173158++,_0xd41804();}),_0x1f68d6['on'](_0x33def5(0x130),function(){_0x16f713?_0x43778c({'success':![],'message':_0x16f713}):_0x43778c({'success':!![],'count':_0x5556c1-_0x4f12c9+0x1});});}):{'success':![],'message':_0x3ad572(0x12b)};}module[_0x14e30d(0x117)][_0x14e30d(0x14a)]=_0x22ae0b,ipcMain[_0x14e30d(0x165)](_0x14e30d(0x164),async(_0x40bbd1,_0x479b74)=>{return await _0x22ae0b(_0x479b74);});}function extractDeadline(_0x25e2bd){const _0x3c2073=a0_0x38088e;if(!_0x25e2bd)return null;const _0x45dc2b=[/\b(\d{4})[./-년\s]+(\d{1,2})[./-월\s]+(\d{1,2})[일\s]*\b/,/\b(\d{1,2})[\/.](\d{1,2})\b/,/(\d{1,2})월\s*(\d{1,2})일/];for(let _0x4387d2=0x0;_0x4387d2<_0x45dc2b[_0x3c2073(0x11d)];_0x4387d2++){const _0x178093=_0x25e2bd[_0x3c2073(0x141)](_0x45dc2b[_0x4387d2]);if(_0x178093){let _0x263b75,_0x2c443d,_0x8e67a6;const _0x37fe3c=new Date(),_0x43977a=_0x37fe3c[_0x3c2073(0x166)]();if(_0x4387d2===0x0)_0x263b75=parseInt(_0x178093[0x1]),_0x2c443d=parseInt(_0x178093[0x2]),_0x8e67a6=parseInt(_0x178093[0x3]);else{_0x2c443d=parseInt(_0x178093[0x1]),_0x8e67a6=parseInt(_0x178093[0x2]);let _0x23aa2a=new Date(_0x43977a,_0x2c443d-0x1,_0x8e67a6);const _0x68d08d=new Date(_0x37fe3c['getFullYear'](),_0x37fe3c[_0x3c2073(0x174)](),_0x37fe3c[_0x3c2073(0x16d)]());_0x263b75=_0x23aa2a<_0x68d08d?_0x43977a+0x1:_0x43977a;}if(_0x2c443d>=0x1&&_0x2c443d<=0xc&&_0x8e67a6>=0x1&&_0x8e67a6<=0x1f){const _0x3a009c=_0x263b75+'-'+String(_0x2c443d)[_0x3c2073(0x12f)](0x2,'0')+'-'+String(_0x8e67a6)[_0x3c2073(0x12f)](0x2,'0');return console[_0x3c2073(0x10f)](_0x3c2073(0x11f)+_0x25e2bd[_0x3c2073(0x159)](0x0,0x14)+_0x3c2073(0x163)+_0x3a009c),_0x3a009c;}}}return null;}module['exports']=setupMailIpc;