<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>환경설정</title>
  <link rel="stylesheet" href="style.css">
  <style>
    html, body { background: #fff; width: 100vw; height: 100vh; margin: 0; padding: 0; }
    .settings-wrap { max-width: 400px; margin: 40px auto; padding: 24px; border-radius: 12px; box-shadow: 0 2px 16px #0002; background: #f9f9f9; }
    .settings-title { font-size: 1.3em; font-weight: bold; margin-bottom: 18px; }
    .form-row { margin-bottom: 18px; display: flex; align-items: center; }
    .form-row label { flex: 1; }
    .form-row input[type="checkbox"] { transform: scale(1.2); margin-left: 8px; }
    .close-btn { float: right; background: none; border: none; font-size: 1.5em; color: #028b6b; cursor: pointer; }
  </style>
</head>
<body>
  <div class="settings-wrap">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
      <span style="font-size:1.15em;font-weight:bold;color:#00b49c;">환경설정</span>
      <button id="custom-close-btn" style="background:none;border:none;font-size:1.5em;color:#028b6b;cursor:pointer;line-height:1;">×</button>
    </div>
    <!-- <div class="settings-title">환경설정</div> -->
    <div class="form-row">
              <div class="form-row">
                <label for="protocol">방식/보안</label>
                <select id="protocol" class="short-input">
                  <option value="imap">IMAP</option>
                  <option value="imap-ssl">IMAP(SSL, 993)</option>
                  <option value="pop3">POP3</option>
                  <option value="pop3-ssl">POP3(SSL, 995)</option>
                </select>
              </div>
          <div class="form-row">
            <label for="imapPort">IMAP 포트</label>
            <input type="number" id="imapPort" class="short-input" placeholder="예: 143 또는 993" min="1" max="65535" />
          </div>
      <label for="autoLaunchChk">시작 시 자동실행</label>
      <input type="checkbox" id="autoLaunchChk" />
    </div>
    <div class="btn-row" style="display:flex;justify-content:flex-end;gap:12px;margin-top:18px;">
      <button class="ok-btn" id="okSettings" style="background:#00b49c;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:1em;cursor:pointer;">확인</button>
      <button class="close-btn" id="closeSettings" style="background:#aaa;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:1em;cursor:pointer;">닫기</button>
      <button class="ok-btn" id="openMailList" style="background:#fff;color:#00b49c;border:1.5px solid #00b49c;border-radius:6px;padding:8px 18px;font-size:1em;cursor:pointer;">메일보기</button>
    </div>
  </div>
  <script>
    // 커스텀 닫기 버튼 동작
    document.getElementById('custom-close-btn').onclick = () => window.close();
    let lastChecked = false;
    window.electronAPI.getAutoLaunch().then(enabled => {
      document.getElementById('autoLaunchChk').checked = !!enabled;
      lastChecked = !!enabled;
    });


    // 메일 연동정보 자동 입력 함수
    async function loadMailSettings() {
      try {
        const settings = await window.electronAPI.getMailSettings();
        if (settings && settings.mailId) {
          if (document.getElementById('protocol')) document.getElementById('protocol').value = settings.protocol || 'imap-ssl';
          if (document.getElementById('mailId')) document.getElementById('mailId').value = settings.mailId || '';
          if (document.getElementById('mailPw')) document.getElementById('mailPw').value = settings.mailPw || '';
          if (document.getElementById('host')) document.getElementById('host').value = settings.host || '';
          if (document.getElementById('imapPort')) document.getElementById('imapPort').value = settings.port || '';
          if (document.getElementById('mailSince')) document.getElementById('mailSince').value = settings.mailSince || '';
          console.log('기존 메일 설정 로드 완료');
        }
      } catch (err) {
        console.error('메일 설정 불러오기 실패:', err);
      }
    }
    window.addEventListener('DOMContentLoaded', loadMailSettings);

    document.getElementById('openMailList').onclick = () => {
      window.open('mail-list.html', 'mailList', 'width=800,height=600');
    };

    document.getElementById('okSettings').onclick = () => {
      const checked = document.getElementById('autoLaunchChk').checked;
      if (checked !== lastChecked) {
        window.electronAPI.setAutoLaunch(checked);
      }
      window.close();
    };
    document.getElementById('closeSettings').onclick = () => window.close();
    // 엔터키로 확인
    document.addEventListener('keydown', e => {
      if (e.key === 'Enter') document.getElementById('okSettings').click();
    });
  </script>
</body>
</html>
